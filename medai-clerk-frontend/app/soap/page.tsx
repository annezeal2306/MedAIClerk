"use client";import{useState}from"react";const API_BASE=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8001";export default function SoapPage(){const[notes,setNotes]=useState("");const[soap,setSoap]=useState("");const[icd,setIcd]=useState("");const[loadingSoap,setLoadingSoap]=useState(false);const[loadingIcd,setLoadingIcd]=useState(false);const[err,setErr]=useState("");const genSoap=async()=>{if(!notes.trim())return setErr("Please enter patient notes.");setErr("");setLoadingSoap(true);try{const res=await fetch(`${API_BASE}/api/generate-soap-note`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes})});const data=await res.json();if(!res.ok)throw new Error(data.error||"Failed to generate SOAP note");setSoap(data.soap_note||"");}catch(e){setErr(e.message||String(e));}finally{setLoadingSoap(false);}};const genIcd=async()=>{if(!notes.trim())return setErr("Please enter patient notes.");setErr("");setLoadingIcd(true);try{const res=await fetch(`${API_BASE}/api/suggest-icd-codes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes})});const data=await res.json();if(!res.ok)throw new Error(data.error||"Failed to suggest ICD‑10 codes");setIcd(Array.isArray(data.icd_codes)?data.icd_codes.join("\n"):data.icd_codes||"");}catch(e){setErr(e.message||String(e));}finally{setLoadingIcd(false);}};return(<section className="py-10"><h1 className="text-3xl font-bold mb-6">Generate SOAP & ICD‑10</h1><div className="grid gap-6 lg:grid-cols-2"><div className="space-y-4"><textarea value={notes} onChange={e=>setNotes(e.target.value)} placeholder="Paste patient notes or transcript..." className="w-full min-h-[240px] rounded-2xl border bg-background/60 p-4"/><div className="flex gap-3"><button onClick={genSoap} disabled={loadingSoap} className="rounded-xl bg-foreground text-background px-4 py-2">{loadingSoap?"Generating...":"Generate SOAP"}</button><button onClick={genIcd} disabled={loadingIcd} className="rounded-xl border px-4 py-2">{loadingIcd?"Suggesting...":"Suggest ICD‑10"}</button></div>{err&&<p className="text-red-400 text-sm">{err}</p>}</div><div className="space-y-6"><div className="rounded-2xl border bg-card/40 p-4"><h2 className="font-semibold mb-2">SOAP Note</h2><pre className="whitespace-pre-wrap text-sm">{soap||"No output yet."}</pre></div><div className="rounded-2xl border bg-card/40 p-4"><h2 className="font-semibold mb-2">ICD‑10 Suggestions</h2><pre className="whitespace-pre-wrap text-sm">{icd||"No output yet."}</pre></div></div></div></section>);}